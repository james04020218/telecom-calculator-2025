<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKY/HCN ê²°í•© í• ì¸ ê³„ì‚°ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 
        Application Structure Plan:
        - New calculator for SKY/HCN based on KT calculator UI/UX.
        - Provider selection (SKY/HCN) at the top.
        - Dynamic population of Internet and TV plans based on provider.
        - SKY: Differentiates standalone internet vs. internet bundled with TV. TV plans are add-ons. "30% discount (no gift)" option.
            - MODIFIED: SKY "no gift discount" checkbox is now enabled/disabled based on internet speed.
        - HCN: Lists available internet. TV plans are add-ons. "ë™ë“±ê²°í•© í• ì¸" for specific bundles.
        - WiFi, Installation, Gift logic adapted for SKY/HCN.
        - Removed KT-specific discount types, mobile inputs, and KT addons.
        - Simplified message scripts.
        - Added display for discount name.
    -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .input-group { margin-bottom: 1.5rem; }
        .input-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: #334155; }
        .input-field, .select-field { width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #cbd5e1; border-radius: 0.375rem; box-shadow: sm; }
        .input-field:focus, .select-field:focus { border-color: #0ea5e9; outline: none; box-shadow: 0 0 0 0.2rem rgba(14, 165, 233, 0.25); }
        .input-field:disabled, .select-field:disabled { background-color: #e2e8f0; cursor: not-allowed; }
        .btn-primary { background-color: #0ea5e9; color: white; padding: 0.75rem 1.5rem; border-radius: 0.375rem; font-weight: 600; }
        .btn-primary:hover { background-color: #0284c7; }
        .btn-secondary { background-color: #64748b; color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 500; }
        .btn-secondary:hover { background-color: #475569; }
        .section-title { font-size: 1.5rem; font-weight: 700; color: #0369a1; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #38bdf8; }
        .result-card { background-color: white; padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); margin-bottom: 1.5rem; }
        .result-label { color: #475569; }
        .result-value { color: #1e293b; font-weight: 600;}
        .total-value { color: #f59e0b; font-size: 1.5rem; font-weight: 700;}
        .radio-label { margin-right: 1rem; margin-bottom: 0.5rem; display: inline-flex; align-items: center; cursor: pointer;}
        .radio-input { margin-right: 0.5rem; accent-color: #0ea5e9; }
        .radio-input:disabled + span { color: #94a3b8; } /* Style for text next to disabled radio/checkbox */
        input[type="checkbox"]:disabled { cursor: not-allowed; }
        label:has(input[type="checkbox"]:disabled) { cursor: not-allowed; color: #94a3b8;}

        .summary-item { margin-bottom: 0.25rem; }
        .message-script-area { width: 100%; min-height: 100px; padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 0.375rem; font-size: 0.875rem; white-space: pre-wrap; word-wrap: break-word; }
        .copy-button-container { text-align: right; margin-top: 0.5rem; }
        .copy-feedback { font-size: 0.75rem; color: green; margin-left: 0.5rem; }
    </style>
</head>
<body class="text-slate-800">
    <header class="bg-sky-700 text-white p-6 shadow-md">
        <div class="container mx-auto max-w-4xl">
            <h1 class="text-3xl font-bold text-center">SKY/HCN ê²°í•© í• ì¸ ê³„ì‚°ê¸°</h1>
            <p class="text-center text-sky-200 mt-1">ì„ íƒí•˜ì‹  ìƒí’ˆì˜ ì˜ˆìƒ ìš”ê¸ˆì„ ê³„ì‚°í•´ ë³´ì„¸ìš”.</p>
        </div>
    </header>

    <main class="container mx-auto max-w-4xl p-4 sm:p-6 lg:p-8">
        <section id="providerSelectionSection" class="mb-8">
            <h2 class="section-title">0. í†µì‹ ì‚¬ ì„ íƒ</h2>
            <div class="input-group">
                <div class="flex items-center space-x-4">
                    <label class="radio-label">
                        <input type="radio" name="serviceProvider" value="sky" class="radio-input" checked>
                        <span>KT Skylife (SKY)</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="serviceProvider" value="hcn" class="radio-input">
                        <span>HCN (KT HCN)</span>
                    </label>
                </div>
            </div>
        </section>

        <section id="inputSection" class="mb-8">
            <h2 class="section-title">1. ì„œë¹„ìŠ¤ ì„ íƒ (3ë…„ ì•½ì • ê¸°ì¤€, VAT í¬í•¨)</h2>
            
            <div id="skyInternetTypeGroup" class="input-group">
                <label class="input-label">SKY ì¸í„°ë„· ìœ í˜• ì„ íƒ</label>
                <div class="flex items-center space-x-4">
                    <label class="radio-label">
                        <input type="radio" name="skyInternetType" value="bundle_tv" class="radio-input" checked>
                        <span>SKY ì¸í„°ë„· + TV ë²ˆë“¤</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="skyInternetType" value="standalone" class="radio-input">
                        <span>SKY ì¸í„°ë„· ë‹¨ë…</span>
                    </label>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="input-group">
                    <label for="internetPlan" class="input-label">ì¸í„°ë„· ìš”ê¸ˆì œ</label>
                    <select id="internetPlan" class="select-field">
                        </select>
                </div>
                
                <div class="input-group">
                    <label for="tvPlan" class="input-label">TV ìƒí’ˆ</label>
                    <select id="tvPlan" class="select-field">
                        <option value="none">TV ì„ íƒ ì•ˆí•¨</option>
                        </select>
                </div>

                <div class="input-group">
                    <label for="wifiRouter" class="input-label block mb-1">ì™€ì´íŒŒì´ ê³µìœ ê¸°</label>
                     <select id="wifiRouter" class="select-field">
                        </select>
                </div>
                
                <div id="skyGiftDiscountOptionGroup" class="input-group hidden">
                     <label for="skyNoGiftDiscount" class="input-label flex items-center cursor-pointer">
                        <input type="checkbox" id="skyNoGiftDiscount" class="radio-input h-5 w-5 mr-2">
                        <span>ì‚¬ì€í’ˆ ë¯¸ì„ íƒ ì‹œ 30% í• ì¸ ì ìš© (100M/200M ì¸í„°ë„·)</span>
                    </label>
                </div>
            </div>
        </section>

        <section id="installationSection" class="mb-8">
            <h2 class="section-title">2. ì„¤ì¹˜ ì˜µì…˜</h2>
            <div class="input-group bg-white p-6 rounded-lg shadow">
                <label class="input-label">ì„¤ì¹˜ í¬ë§ ì‹œì  (ì„¤ì¹˜ë¹„ ë³€ë™)</label>
                <div class="space-y-2">
                    <label class="radio-label"><input type="radio" name="installationTime" value="weekday" class="radio-input" checked> <span>í‰ì¼ ì£¼ê°„</span></label>
                    <label class="radio-label"><input type="radio" name="installationTime" value="weekend" class="radio-input"> <span>ì£¼ë§/ì•¼ê°„ (í• ì¦ ì ìš©)</span></label>
                </div>
            </div>
        </section>

        <div class="text-center mb-8">
            <button id="calculateButton" class="btn-primary text-lg">ì˜ˆìƒ ìš”ê¸ˆ ê³„ì‚°í•˜ê¸°</button>
        </div>

        <section id="resultSection" class="hidden">
            <h2 class="section-title">ğŸ“Š ê³„ì‚° ê²°ê³¼</h2>
            
            <div class="result-card">
                <h3 class="text-xl font-semibold text-sky-600 mb-3">ìš”ê¸ˆ ìš”ì•½ (VAT í¬í•¨)</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <p class="result-label summary-item">ì„ íƒ í†µì‹ ì‚¬: <span id="selectedProviderDisplay" class="result-value"></span></p>
                        <p class="result-label summary-item">ì„ íƒ ì¸í„°ë„·: <span id="selectedInternet" class="result-value"></span></p>
                        <p class="result-label summary-item">ì„ íƒ TV: <span id="selectedTv" class="result-value"></span></p>
                    </div>
                    <div>
                        <p class="result-label summary-item">ì›” ì¸í„°ë„· ê¸°ë³¸ë£Œ: <span id="totalBaseInternetCost" class="result-value">0</span> ì›</p>
                        <p class="result-label summary-item">ì›” TV ì¶”ê°€ìš”ê¸ˆ: <span id="tvAddonCostDisplay" class="result-value">0</span> ì›</p>
                        <p class="result-label summary-item">ì›” ì™€ì´íŒŒì´ ê³µìœ ê¸° ì„ëŒ€ë£Œ: <span id="wifiRouterRentalCostDisplay" class="result-value">0</span> ì›</p>
                        <p class="result-label summary-item">ì ìš©ëœ í• ì¸ëª…: <span id="discountNameDisplay" class="result-value text-green-600"></span></p>
                        <p class="result-label summary-item">ì›” í• ì¸ ê¸ˆì•¡: <span id="totalDiscountAmount" class="result-value text-green-600">0</span> ì›</p>
                        <hr class="my-1 border-sky-300">
                        <p class="mt-2 text-lg font-semibold">ìµœì¢… ì˜ˆìƒ ì›” ë‚©ë¶€ì•¡: <span id="finalMonthlyCost" class="total-value">0</span> ì›</p>
                    </div>
                </div>
            </div>

            <div class="result-card">
                <h3 class="text-xl font-semibold text-sky-600 mb-3">ğŸ ì‚¬ì€í’ˆ í˜œíƒ (ì˜ˆìƒ)</h3>
                <p class="result-label summary-item">ì‚¬ì€í’ˆ: <span id="giftValue" class="result-value">0</span> ì›</p>
                <p id="giftNote" class="text-xs text-slate-500 mt-1"></p>
            </div>

            <div class="result-card">
                <h3 class="text-xl font-semibold text-sky-600 mb-3">ì´ˆê¸° ì„¤ì¹˜ ë¹„ìš©</h3>
                <p class="result-label">ì˜ˆìƒ ì´ ì„¤ì¹˜ë¹„: <span id="installationCostResult" class="result-value text-lg">0</span> ì›</p>
            </div>
        </section>
        
        <section id="messageScriptSection" class="hidden mt-12">
            <h2 class="section-title">ğŸ“„ ê³ ê° ì•ˆë‚´ ë¬¸ì ìŠ¤í¬ë¦½íŠ¸ (ìƒë‹´ì› ì°¸ê³ ìš©)</h2>
            <div class="result-card">
                <h3 class="text-xl font-semibold text-sky-600 mb-3">1. ìƒë‹´ ë©”ëª¨</h3>
                <textarea id="memoScript" class="message-script-area" readonly></textarea>
                <div class="copy-button-container">
                    <button onclick="copyToClipboard('memoScript', 'copyFeedbackMemo')" class="btn-secondary text-xs">ë³µì‚¬í•˜ê¸°</button>
                    <span id="copyFeedbackMemo" class="copy-feedback"></span>
                </div>
            </div>
             <div class="result-card">
                <h3 class="text-xl font-semibold text-sky-600 mb-3">2. ë¯¼ê°ì •ë³´ ì „ì†¡ìš© ë§í¬ (ê³ ê° ë°œì†¡ìš©)</h3>
                <textarea id="sensitiveInfoLinkScriptSkyHcn" class="message-script-area" readonly></textarea>
                <div class="copy-button-container">
                    <button onclick="copyToClipboard('sensitiveInfoLinkScriptSkyHcn', 'copyFeedbackSensitiveInfoSkyHcn')" class="btn-secondary text-xs">ë³µì‚¬í•˜ê¸°</button>
                    <span id="copyFeedbackSensitiveInfoSkyHcn" class="copy-feedback"></span>
                </div>
            </div>
        </section>
    </main>

    <footer class="text-center p-6 mt-12 bg-sky-800 text-sky-200 text-sm">
        <p>ë³¸ ê³„ì‚°ê¸°ëŠ” ë¯¸ì†Œì—ì„œ ì œê³µí•©ë‹ˆë‹¤.</p>
        <p>&copy; 2024 SKY/HCN ê²°í•© í• ì¸ ê³„ì‚°ê¸°. ëª¨ë“  ì •ë³´ëŠ” ì°¸ê³ ìš©ì…ë‹ˆë‹¤.</p>
    </footer>

    <script>
        const providerData = {
          "kt_skylife": {
            "service_provider": "KT Skylife (SKY)",
            "currency": "KRW",
            "general_notes": [
              "ëª¨ë“  ì›” ìš”ê¸ˆì€ ë¶€ê°€ì„¸ í¬í•¨ ê°€ê²©ì¼ ìˆ˜ ìˆìœ¼ë©°, ì•½ì • ì¡°ê±´ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
            ],
            "internet_plans": {
              "standalone": [
                { "speed": "100Mbps", "monthly_fee": 22000, "description": "SKYì¸í„°ë„·(ë‹¨ë…) 100mb", "id": "sky_inet_s_100" },
                { "speed": "200Mbps", "monthly_fee": 24200, "description": "SKYì¸í„°ë„·(ë‹¨ë…) 200mb", "id": "sky_inet_s_200" },
                { "speed": "500Mbps", "monthly_fee": 33000, "description": "SKYì¸í„°ë„·(ë‹¨ë…) 500mb", "id": "sky_inet_s_500" },
                { "speed": "1Gbps", "monthly_fee": 38500, "description": "SKYì¸í„°ë„·(ë‹¨ë…) 1GB", "id": "sky_inet_s_1g" }
              ],
              "base_for_tv_bundle": [
                { "speed": "100Mbps", "monthly_fee": 19800, "description": "SKYì¸í„°ë„· 100mb (TV ê²°í•© ì‹œ)", "id": "sky_inet_b_100" },
                { "speed": "200Mbps", "monthly_fee": 22000, "description": "SKYì¸í„°ë„· 200mb (TV ê²°í•© ì‹œ)", "id": "sky_inet_b_200" },
                { "speed": "500Mbps", "monthly_fee": 27500, "description": "SKYì¸í„°ë„· 500mb (TV ê²°í•© ì‹œ)", "id": "sky_inet_b_500" },
                { "speed": "1Gbps", "monthly_fee": 33000, "description": "SKYì¸í„°ë„· 1G (TV ê²°í•© ì‹œ)", "id": "sky_inet_b_1g" }
              ]
            },
            "tv_plan_add_on_fees_for_bundles": [
              { "internet_speed_condition": "100Mbps", "tv_plan_name": "SKY ALL", "additional_monthly_fee_for_tv": 9900, "id": "sky_tv_all_100" }, 
              { "internet_speed_condition": "100Mbps", "tv_plan_name": "SKY í¬ì¸íŠ¸", "additional_monthly_fee_for_tv": 12100, "id": "sky_tv_point_100" }, 
              { "internet_speed_condition": "200Mbps", "tv_plan_name": "SKY ALL", "additional_monthly_fee_for_tv": 9900, "id": "sky_tv_all_200" }, 
              { "internet_speed_condition": "200Mbps", "tv_plan_name": "SKY í¬ì¸íŠ¸", "additional_monthly_fee_for_tv": 12100, "id": "sky_tv_point_200" }, 
              { "internet_speed_condition": "500Mbps", "tv_plan_name": "SKY ALL", "additional_monthly_fee_for_tv": 9900, "id": "sky_tv_all_500" }, 
              { "internet_speed_condition": "500Mbps", "tv_plan_name": "SKY í¬ì¸íŠ¸", "additional_monthly_fee_for_tv": 12100, "id": "sky_tv_point_500" }, 
              { "internet_speed_condition": "1Gbps", "tv_plan_name": "SKY ALL", "additional_monthly_fee_for_tv": 9900, "id": "sky_tv_all_1g" },   
              { "internet_speed_condition": "1Gbps", "tv_plan_name": "SKY í¬ì¸íŠ¸", "additional_monthly_fee_for_tv": 12100, "id": "sky_tv_point_1g" }  
            ],
            "equipment": {
              "wifi_router": [ 
                { "condition": "100Mbps ì¸í„°ë„· ê°€ì… ì‹œ", "monthly_fee": 1100, "id": "sky_wifi_100" },
                { "condition": "200Mbps ì´ìƒ ì¸í„°ë„· ê°€ì… ì‹œ", "monthly_fee": 0, "notes": "ë¬´ë£Œ ì œê³µ", "id": "sky_wifi_200plus" }
              ]
            },
            "installation_fees": [
              { "service_description": "ì¸í„°ë„· + TV ì„¤ì¹˜ë¹„", "fee": 36300, "timing": "weekday" },
              { "service_description": "ì¸í„°ë„· + TV ì„¤ì¹˜ë¹„ (ì£¼ë§/ì•¼ê°„)", "fee": 45375, "timing": "weekend" }
            ],
            "bundle_discounts": [
              { "discount_name": "30% í• ì¸ (ì‚¬ì€í’ˆ ë¯¸ì„ íƒ ì‹œ)", "internet_speed_condition": "100Mbps", "discount_amount": 8800, "notes": "100MB ìƒí’ˆ ê°€ì…í•˜ê³  ì‚¬ì€í’ˆ ë¯¸ì„ íƒ ì‹œ ì ìš©ë˜ëŠ” í• ì¸ìœ¼ë¡œ ë³´ì„" },
              { "discount_name": "30% í• ì¸ (ì‚¬ì€í’ˆ ë¯¸ì„ íƒ ì‹œ)", "internet_speed_condition": "200Mbps", "discount_amount": 8800, "notes": "200MB ìƒí’ˆ ê°€ì…í•˜ê³  ì‚¬ì€í’ˆ ë¯¸ì„ íƒ ì‹œ ì ìš©ë˜ëŠ” í• ì¸ìœ¼ë¡œ ë³´ì„" }
            ],
            "promotional_gifts": {
              "internet_standalone": [
                { "internet_speed": "100Mbps", "gift_value": 100000 },
                { "internet_speed": "200Mbps", "gift_value": 120000 },
                { "internet_speed": "500Mbps", "gift_value": 140000 },
                { "internet_speed": "1Gbps", "gift_value": 150000 }
              ],
              "internet_tv_bundle": [
                { "bundle_description": "Skylife 100Mbps ì¸í„°ë„· + TV ê²°í•©", "gift_value": 350000, "internet_speed": "100Mbps" },
                { "bundle_description": "Skylife 200Mbps ì¸í„°ë„· + TV ê²°í•©", "gift_value": 360000, "internet_speed": "200Mbps" },
                { "bundle_description": "Skylife 500Mbps ì¸í„°ë„· + TV ê²°í•©", "gift_value": 420000, "internet_speed": "500Mbps" },
                { "bundle_description": "Skylife 1Gbps ì¸í„°ë„· + TV ê²°í•©", "gift_value": 450000, "internet_speed": "1Gbps" }
              ]
            }
          },
          "hcn": {
            "service_provider": "HCN (KT HCN)",
            "currency": "KRW",
            "general_notes": [
              "ëª¨ë“  ì›” ìš”ê¸ˆì€ ë¶€ê°€ì„¸ í¬í•¨ ê°€ê²©ì¼ ìˆ˜ ìˆìœ¼ë©°, ì•½ì • ì¡°ê±´ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
            ],
            "internet_plans": [
              { "speed": "100Mbps", "monthly_fee": 18398, "network_provider": "HCN ìì²´ë§ ì¶”ì •", "description": "HCNì¸í„°ë„· 100mb", "id":"hcn_inet_self_100"},
              { "speed": "100Mbps", "monthly_fee": 13750, "network_provider": "SKYë§", "description": "HCNì¸í„°ë„· 100mb (SKYë§)", "id":"hcn_inet_sky_100" },
              { "speed": "200Mbps", "monthly_fee": 15950, "network_provider": "SKYë§", "description": "HCNì¸í„°ë„· 200mb (SKYë§)", "id":"hcn_inet_sky_200" },
              { "speed": "500Mbps", "monthly_fee": 27500, "network_provider": "SKYë§", "description": "HCNì¸í„°ë„· 500mb (SKYë§)", "id":"hcn_inet_sky_500" }
            ],
            "tv_plan_add_on_fees_for_bundles": [
              { "bundle_name": "HCN 100M + UHD ê³¨ë“œ TV", "internet_condition": "HCN 100Mbps ì¸í„°ë„· ì‚¬ìš© ì‹œ", "tv_plan_name": "UHD ê³¨ë“œ TV", "additional_monthly_fee_for_tv": 9900, "id": "hcn_tv_uhd_gold"},
              { "bundle_name": "HCN 100M + ë¬´ì•½ì • TV", "internet_condition": "HCN 100Mbps ì¸í„°ë„· ì‚¬ìš© ì‹œ", "tv_plan_name": "ë¬´ì•½ì • TV", "additional_monthly_fee_for_tv": 7617, "notes": "ì…‹íƒ‘ë°•ìŠ¤ ì—†ìŒ, ê²°í•© í• ì¸ ì ìš© ë¶ˆê°€ ì¡°ê±´ì¼ ìˆ˜ ìˆìŒ", "id": "hcn_tv_no_contract" }
            ],
            "equipment": {
              "wifi_router": [ 
                { "monthly_fee": 1100, "id":"hcn_wifi", "condition": "HCN ê³µìœ ê¸°" }
              ]
            },
            "installation_fees": [
              { "service_description": "ì¸í„°ë„· + TV ì„¤ì¹˜ë¹„", "fee": 33000, "timing": "weekday" }
            ],
            "bundle_discounts": [
              { "discount_name": "ë™ë“±ê²°í•© í• ì¸", "bundle_condition": "HCN 100M + UHD ê³¨ë“œ TV ê²°í•© ì‹œ", "discount_amount": 1018, "internet_id_ref": "hcn_inet_self_100", "tv_id_ref": "hcn_tv_uhd_gold" } 
            ],
            "promotional_gifts": {
              "internet_tv_bundle": [
                { "bundle_description": "HCN 100M + UHD ê³¨ë“œ TV ê²°í•©", "gift_value": 150000, "internet_id_ref": "hcn_inet_self_100", "tv_id_ref": "hcn_tv_uhd_gold" },
                { "bundle_description": "HCN 100M + ë¬´ì•½ì • TV (ì…‹íƒ‘ì—†ìŒ, ê²°í•©ë¶ˆê°€) ê²°í•©", "gift_value": 120000, "internet_id_ref": "hcn_inet_self_100", "tv_id_ref": "hcn_tv_no_contract" }
              ]
            }
          }
        };

        // DOM Elements
        const providerRadios = document.querySelectorAll('input[name="serviceProvider"]');
        const skyInternetTypeGroupEl = document.getElementById('skyInternetTypeGroup');
        const skyInternetTypeRadios = document.querySelectorAll('input[name="skyInternetType"]');
        const internetPlanEl = document.getElementById('internetPlan');
        const tvPlanEl = document.getElementById('tvPlan');
        const wifiRouterEl = document.getElementById('wifiRouter');
        const skyNoGiftDiscountEl = document.getElementById('skyNoGiftDiscount');
        const skyGiftDiscountOptionGroupEl = document.getElementById('skyGiftDiscountOptionGroup');
        const installationTimeRadios = document.querySelectorAll('input[name="installationTime"]');
        
        const calculateButton = document.getElementById('calculateButton');
        const resultSection = document.getElementById('resultSection');
        const messageScriptSectionEl = document.getElementById('messageScriptSection');

        // Result display elements
        const selectedProviderDisplayEl = document.getElementById('selectedProviderDisplay');
        const selectedInternetEl = document.getElementById('selectedInternet');
        const selectedTvEl = document.getElementById('selectedTv');
        const totalBaseInternetCostEl = document.getElementById('totalBaseInternetCost');
        const tvAddonCostDisplayEl = document.getElementById('tvAddonCostDisplay');
        const wifiRouterRentalCostDisplayEl = document.getElementById('wifiRouterRentalCostDisplay');
        const discountNameDisplayEl = document.getElementById('discountNameDisplay'); 
        const totalDiscountAmountEl = document.getElementById('totalDiscountAmount');
        const finalMonthlyCostEl = document.getElementById('finalMonthlyCost');
        const giftValueEl = document.getElementById('giftValue');
        const giftNoteEl = document.getElementById('giftNote');
        const installationCostResultEl = document.getElementById('installationCostResult');
        
        const memoScriptEl = document.getElementById('memoScript');
        const sensitiveInfoLinkScriptSkyHcnEl = document.getElementById('sensitiveInfoLinkScriptSkyHcn');

        // --- Helper Functions ---
        function getSelectedProviderData() {
            const selectedProviderValue = document.querySelector('input[name="serviceProvider"]:checked').value;
            return providerData[selectedProviderValue === 'sky' ? 'kt_skylife' : 'hcn'];
        }

        // MODIFIED: New function to update SKY "no gift" discount checkbox state
        function updateSkyNoGiftDiscountCheckboxState() {
            const currentProviderData = getSelectedProviderData();
            // Ensure the checkbox and its group are visible (i.e., SKY is selected)
            if (!currentProviderData.service_provider.includes("SKY") || skyGiftDiscountOptionGroupEl.style.display === 'none') {
                skyNoGiftDiscountEl.disabled = true;
                skyNoGiftDiscountEl.checked = false;
                return;
            }

            const selectedInternetOption = internetPlanEl.options[internetPlanEl.selectedIndex];
            if (selectedInternetOption && selectedInternetOption.value !== 'none') {
                const speed = selectedInternetOption.dataset.speed;
                if (speed === "100Mbps" || speed === "200Mbps") {
                    skyNoGiftDiscountEl.disabled = false;
                } else {
                    skyNoGiftDiscountEl.disabled = true;
                    skyNoGiftDiscountEl.checked = false; // Uncheck if disabled due to speed mismatch
                }
            } else { // No internet plan selected or "ì„ íƒ ì•ˆí•¨"
                skyNoGiftDiscountEl.disabled = true;
                skyNoGiftDiscountEl.checked = false;
            }
        }


        function populateInternetPlans() {
            const data = getSelectedProviderData();
            const selectedSkyInternetType = skyInternetTypeGroupEl.style.display !== 'none' ? document.querySelector('input[name="skyInternetType"]:checked').value : null;
            internetPlanEl.innerHTML = '<option value="none">ì„ íƒ ì•ˆí•¨</option>';

            let plansToShow = [];
            if (data.service_provider.includes("SKY")) {
                if (selectedSkyInternetType === 'standalone') {
                    plansToShow = data.internet_plans.standalone;
                } else { // bundle_tv
                    plansToShow = data.internet_plans.base_for_tv_bundle;
                }
            } else { // HCN
                plansToShow = data.internet_plans;
            }

            plansToShow.forEach(plan => {
                const option = document.createElement('option');
                option.value = plan.id || plan.speed; 
                option.textContent = `${plan.description} (ì›” ${plan.monthly_fee.toLocaleString()}ì›)`;
                option.dataset.price = plan.monthly_fee;
                option.dataset.speed = plan.speed;
                option.dataset.id = plan.id; 
                internetPlanEl.appendChild(option);
            });

            if (internetPlanEl.options.length > 1) { 
                internetPlanEl.selectedIndex = 1;
            } else {
                internetPlanEl.selectedIndex = 0; 
            }
            
            populateTvPlans(); 
            populateWifiOptions(); 
            handleWifiLogic(); 
            updateSkyNoGiftDiscountCheckboxState(); // MODIFIED: Call here
        }

        function populateTvPlans() {
            const data = getSelectedProviderData();
            tvPlanEl.innerHTML = '<option value="none">TV ì„ íƒ ì•ˆí•¨</option>';
            if (!data.tv_plan_add_on_fees_for_bundles) return;

            const selectedInternetOption = internetPlanEl.options[internetPlanEl.selectedIndex];
            const selectedInternetSpeed = selectedInternetOption ? selectedInternetOption.dataset.speed : null;

            const uniqueTvPlans = {}; 
            data.tv_plan_add_on_fees_for_bundles.forEach(tvPlan => {
                let addPlan = false;
                if (data.service_provider.includes("SKY")) {
                    if (selectedInternetSpeed && tvPlan.internet_speed_condition === selectedInternetSpeed) {
                       addPlan = true;
                    }
                } else { 
                    addPlan = true; 
                }

                if(addPlan && !uniqueTvPlans[tvPlan.id]){ 
                     uniqueTvPlans[tvPlan.id] = tvPlan;
                }
            });
            
            for(const id in uniqueTvPlans) {
                const tvPlan = uniqueTvPlans[id];
                const option = document.createElement('option');
                option.value = tvPlan.id;
                option.textContent = `${tvPlan.tv_plan_name} (ì›” ${tvPlan.additional_monthly_fee_for_tv.toLocaleString()}ì› ì¶”ê°€)`;
                option.dataset.price = tvPlan.additional_monthly_fee_for_tv;
                option.dataset.name = tvPlan.tv_plan_name;
                option.dataset.id = tvPlan.id;
                tvPlanEl.appendChild(option);
            }
        }
        
        function populateWifiOptions() {
            const data = getSelectedProviderData();
            wifiRouterEl.innerHTML = ''; 

            if (data.equipment && data.equipment.wifi_router) {
                const wifiConfigs = Array.isArray(data.equipment.wifi_router) ? data.equipment.wifi_router : [data.equipment.wifi_router];
                
                wifiConfigs.forEach(wifi => {
                    const option = document.createElement('option');
                    option.value = wifi.id || String(wifi.monthly_fee); 
                    const conditionText = wifi.condition || (data.service_provider.includes("HCN") ? "HCN ê³µìœ ê¸°" : "ê³µìœ ê¸°"); 
                    option.textContent = `${conditionText} (ì›” ${wifi.monthly_fee.toLocaleString()}ì›)${wifi.notes ? ' - ' + wifi.notes : ''}`;
                    option.dataset.price = wifi.monthly_fee;
                    if (wifi.id) option.dataset.id = wifi.id; 
                    wifiRouterEl.appendChild(option);
                });
            } else {
                const option = document.createElement('option');
                option.value = "0"; 
                option.textContent = "ì™€ì´íŒŒì´ ì •ë³´ ì—†ìŒ";
                option.dataset.price = "0";
                wifiRouterEl.appendChild(option);
            }
        }
        
        function handleWifiLogic() {
            const data = getSelectedProviderData();
            const selectedInternetOption = internetPlanEl.options[internetPlanEl.selectedIndex];
            const selectedInternetSpeed = selectedInternetOption ? selectedInternetOption.dataset.speed : null;

            wifiRouterEl.disabled = false; 

            if (data.service_provider.includes("SKY") && selectedInternetSpeed) {
                const speedMbps = parseInt(selectedInternetSpeed.replace('Mbps','').replace('Gbps','000').replace('G','000'));
                if (speedMbps >= 200) { 
                    const freeWifiOption = Array.from(wifiRouterEl.options).find(opt => opt.dataset.id === "sky_wifi_200plus");
                    if (freeWifiOption) {
                        wifiRouterEl.value = freeWifiOption.value;
                        wifiRouterEl.disabled = true;
                    }
                } else if (speedMbps === 100) {
                    const paidWifiOption = Array.from(wifiRouterEl.options).find(opt => opt.dataset.id === "sky_wifi_100");
                     if (paidWifiOption) {
                        wifiRouterEl.value = paidWifiOption.value;
                    }
                }
            } else if (data.service_provider.includes("HCN")) {
                const hcnWifiOption = Array.from(wifiRouterEl.options).find(opt => opt.dataset.id === "hcn_wifi");
                if (hcnWifiOption) {
                    wifiRouterEl.value = hcnWifiOption.value;
                }
            }
        }

        function handleProviderChange() {
            const selectedProvider = document.querySelector('input[name="serviceProvider"]:checked').value;
            if (selectedProvider === 'sky') {
                skyInternetTypeGroupEl.style.display = 'block';
                skyGiftDiscountOptionGroupEl.style.display = 'block'; 
            } else { // hcn
                skyInternetTypeGroupEl.style.display = 'none';
                skyGiftDiscountOptionGroupEl.style.display = 'none'; 
            }
            populateInternetPlans(); // This will also call updateSkyNoGiftDiscountCheckboxState
        }

        // --- Main Calculation Logic ---
        function calculateAndDisplayResults() {
            try {
                const currentData = getSelectedProviderData();
                const providerName = currentData.service_provider;

                const internetOption = internetPlanEl.options[internetPlanEl.selectedIndex];
                const tvOption = tvPlanEl.options[tvPlanEl.selectedIndex];
                const wifiOption = wifiRouterEl.options[wifiRouterEl.selectedIndex];
                const installationTimeValue = document.querySelector('input[name="installationTime"]:checked').value;
                // Checkbox state is considered only if it's not disabled
                const isSkyNoGiftChecked = providerName.includes("SKY") && 
                                           skyGiftDiscountOptionGroupEl.style.display !== 'none' && 
                                           skyNoGiftDiscountEl.checked && 
                                           !skyNoGiftDiscountEl.disabled;

                let internetBaseFee = 0;
                let internetSpeedForGiftAndDiscount = null;
                let selectedInternetId = null;
                if (internetOption && internetOption.value !== 'none') {
                    internetBaseFee = parseFloat(internetOption.dataset.price) || 0;
                    internetSpeedForGiftAndDiscount = internetOption.dataset.speed;
                    selectedInternetId = internetOption.dataset.id;
                }

                let tvAddonFee = 0;
                let selectedTvPlanName = "TV ì„ íƒ ì•ˆí•¨";
                let selectedTvId = null;
                if (tvOption && tvOption.value !== 'none') {
                    tvAddonFee = parseFloat(tvOption.dataset.price) || 0;
                    selectedTvPlanName = tvOption.dataset.name || "TV ìƒí’ˆ";
                    selectedTvId = tvOption.dataset.id;
                }
                
                let wifiFee = 0;
                if (wifiOption && wifiOption.value !== "0" && wifiOption.dataset.price) { 
                    wifiFee = parseFloat(wifiOption.dataset.price) || 0;
                }
                
                if (providerName.includes("SKY") && internetSpeedForGiftAndDiscount) {
                    const speedMbps = parseInt(internetSpeedForGiftAndDiscount.replace('Mbps','').replace('Gbps','000').replace('G','000'));
                    if (speedMbps >= 200) {
                        wifiFee = 0; 
                    } else if (speedMbps === 100) {
                        wifiFee = 1100; 
                    }
                }

                let totalDiscount = 0;
                let giftValue = 0;
                let giftNoteText = "";
                let discountName = "ì ìš©ëœ í• ì¸ ì—†ìŒ"; 

                if (providerName.includes("SKY")) {
                    if (isSkyNoGiftChecked && (internetSpeedForGiftAndDiscount === "100Mbps" || internetSpeedForGiftAndDiscount === "200Mbps")) {
                        const discountRule = currentData.bundle_discounts.find(d => d.internet_speed_condition === internetSpeedForGiftAndDiscount);
                        if (discountRule) {
                            totalDiscount = discountRule.discount_amount;
                            discountName = discountRule.discount_name; 
                        }
                        giftNoteText = "ì‚¬ì€í’ˆ ë¯¸ì„ íƒ 30% í• ì¸ ì ìš©ë¨";
                        giftValue = 0; 
                    } else {
                        const isSkyBundleTypeSelected = document.querySelector('input[name="skyInternetType"]:checked').value === 'bundle_tv';
                        const isTvActuallySelected = selectedTvId && selectedTvId !== 'none';

                        if (isSkyBundleTypeSelected && isTvActuallySelected && currentData.promotional_gifts.internet_tv_bundle) {
                            const giftRule = currentData.promotional_gifts.internet_tv_bundle.find(g => g.internet_speed === internetSpeedForGiftAndDiscount);
                            if (giftRule) giftValue = giftRule.gift_value;
                        } else if (currentData.promotional_gifts.internet_standalone) { 
                            const giftRule = currentData.promotional_gifts.internet_standalone.find(g => g.internet_speed === internetSpeedForGiftAndDiscount);
                            if (giftRule) giftValue = giftRule.gift_value;
                        }
                         if (giftValue > 0 && !isSkyNoGiftChecked) giftNoteText = "ì‚¬ì€í’ˆ ì§€ê¸‰ ì˜ˆìƒ (ì¡°ê±´ í™•ì¸ í•„ìš”)";
                         else if (isSkyNoGiftChecked && giftValue === 0) giftNoteText = "ì‚¬ì€í’ˆ ë¯¸ì„ íƒ 30% í• ì¸ ì ìš©ë¨";
                         else giftNoteText = "";

                    }
                } else { // HCN
                    if (currentData.bundle_discounts && selectedInternetId && selectedTvId) {
                         const hcnDiscountRule = currentData.bundle_discounts.find(d => d.internet_id_ref === selectedInternetId && d.tv_id_ref === selectedTvId);
                         if (hcnDiscountRule) {
                            totalDiscount = hcnDiscountRule.discount_amount;
                            discountName = hcnDiscountRule.discount_name; 
                         }
                    }
                    if (selectedTvId && selectedTvId !== 'none' && currentData.promotional_gifts.internet_tv_bundle) {
                        const giftRule = currentData.promotional_gifts.internet_tv_bundle.find(g => g.internet_id_ref === selectedInternetId && g.tv_id_ref === selectedTvId);
                        if(giftRule) giftValue = giftRule.gift_value;
                        if (giftValue > 0) giftNoteText = "ì‚¬ì€í’ˆ ì§€ê¸‰ ì˜ˆìƒ (ì¡°ê±´ í™•ì¸ í•„ìš”)";
                    }
                }

                let installationFee = 0;
                if (currentData.installation_fees) {
                    const feeInfo = currentData.installation_fees.find(f => f.timing === installationTimeValue);
                    if (feeInfo) {
                        installationFee = feeInfo.fee;
                    } else { 
                        const weekdayFee = currentData.installation_fees.find(f => f.timing === "weekday");
                        if (weekdayFee) installationFee = weekdayFee.fee;
                        else if (currentData.installation_fees.length > 0) installationFee = currentData.installation_fees[0].fee;
                    }
                }
                
                const totalBeforeDiscount = internetBaseFee + tvAddonFee + wifiFee;
                const finalMonthlyFee = totalBeforeDiscount - totalDiscount;

                // Display results
                selectedProviderDisplayEl.textContent = providerName;
                selectedInternetEl.textContent = internetOption.value !== 'none' ? internetOption.text.split(' (ì›”')[0] : 'ë¯¸ì„ íƒ';
                selectedTvEl.textContent = tvOption.value !== 'none' ? selectedTvPlanName : 'ë¯¸ì„ íƒ';
                
                totalBaseInternetCostEl.textContent = internetBaseFee.toLocaleString();
                tvAddonCostDisplayEl.textContent = tvAddonFee.toLocaleString();
                wifiRouterRentalCostDisplayEl.textContent = wifiFee.toLocaleString();
                discountNameDisplayEl.textContent = discountName; 
                totalDiscountAmountEl.textContent = totalDiscount.toLocaleString();
                finalMonthlyCostEl.textContent = finalMonthlyFee.toLocaleString();

                giftValueEl.textContent = giftValue.toLocaleString();
                giftNoteEl.textContent = giftNoteText;
                installationCostResultEl.textContent = installationFee.toLocaleString();

                resultSection.classList.remove('hidden');
                messageScriptSectionEl.classList.remove('hidden');
                generateMessageScripts(providerName, internetOption.value !== 'none' ? internetOption.text.split(' (ì›”')[0] : 'ë¯¸ì„ íƒ', tvOption.value !== 'none' ? selectedTvPlanName : 'ë¯¸ì„ íƒ', wifiFee, finalMonthlyFee, giftValue, installationFee, installationTimeValue, discountName, totalDiscount);

            } catch (error) {
                console.error("ê³„ì‚° ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                alert("ê³„ì‚° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì…ë ¥ ê°’ì„ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\nì˜¤ë¥˜: " + error.message);
            }
        }
        
        function generateMessageScripts(provider, internetText, tvText, wifiCost, finalFee, gift, installFee, installTimeValue, appliedDiscountName, appliedDiscountAmount) {
            const installTimeDisplay = installTimeValue === 'weekday' ? 'í‰ì¼ì£¼ê°„' : 'ì£¼ë§/ì•¼ê°„';
            let discountInfo = "";
            if (appliedDiscountAmount > 0) {
                discountInfo = `\n   ã„´ í• ì¸ëª…: ${appliedDiscountName} (-${appliedDiscountAmount.toLocaleString()}ì›)`;
            }

            memoScriptEl.value = `[${provider} ë¯¸ì†Œ ìƒë‹´ ë©”ëª¨]
1. ìƒí’ˆ : ${internetText}${tvText === 'ë¯¸ì„ íƒ' ? '' : ' + ' + tvText}${wifiCost > 0 ? ' + ì™€ì´íŒŒì´(ì›” ' + wifiCost.toLocaleString() + 'ì›)' : ' + ì™€ì´íŒŒì´(ë¬´ë£Œ ë˜ëŠ” ë¯¸í¬í•¨)'}
2. ìš”ê¸ˆ : ì›” ${finalFee.toLocaleString()}ì› (VAT í¬í•¨, 3ë…„ ì•½ì • ê¸°ì¤€)${discountInfo}
3. ì‚¬ì€í’ˆ ì´ì•¡ : ${gift.toLocaleString()}ì› (ì˜ˆìƒ, ì¡°ê±´ì— ë”°ë¼ ë³€ë™ ê°€ëŠ¥)
4. ì„¤ì¹˜ë¹„ : ${installFee.toLocaleString()}ì› (${installTimeDisplay}, VAT í¬í•¨, ì²« ë‹¬ 1íšŒ ì²­êµ¬)
5. ê¸°íƒ€ : ì´ì‚¬ ì—¬ë¶€ [ ] / í¬ë§ì„¤ì¹˜ì¼ì [    ë…„   ì›”   ì¼]`;

            sensitiveInfoLinkScriptSkyHcnEl.value = `[${provider}] ê³ ê°ë‹˜, ì›í™œí•œ ì ‘ìˆ˜ë¥¼ ìœ„í•´ ì•„ë˜ ë§í¬ì— ì ‘ì†í•˜ì—¬ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤. ì…ë ¥í•´ì£¼ì‹  ì •ë³´ëŠ” ${provider}ë¡œ ì•ˆì „í•˜ê²Œ ì „ì†¡ë©ë‹ˆë‹¤.
https://miso.kr/booking/forms/secure-details?querystring=ê³ ê°ë‹˜ ì „í™”ë²ˆí˜¸`; 
        }

        function copyToClipboard(elementId, feedbackElementId) {
            const textarea = document.getElementById(elementId);
            if (!textarea) return; 
            textarea.select();
            textarea.setSelectionRange(0, 99999); 
            try {
                const successful = document.execCommand('copy');
                const feedbackEl = document.getElementById(feedbackElementId);
                if (successful) {
                    if (feedbackEl) feedbackEl.textContent = 'ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!';
                } else {
                    if (feedbackEl) feedbackEl.textContent = 'ë³µì‚¬ ì‹¤íŒ¨';
                    navigator.clipboard.writeText(textarea.value).then(() => {
                         if (feedbackEl) feedbackEl.textContent = 'ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! (í´ë¦½ë³´ë“œ API)';
                    }).catch(err => {
                         if (feedbackEl) feedbackEl.textContent = 'ë³µì‚¬ ì‹¤íŒ¨';
                         console.error('Clipboard copy failed: ', err);
                    });
                }
                setTimeout(() => { if (feedbackEl) feedbackEl.textContent = ''; }, 2000);
            } catch (err) {
                const feedbackEl = document.getElementById(feedbackElementId);
                if (feedbackEl) feedbackEl.textContent = 'ë³µì‚¬ ì˜¤ë¥˜';
                 setTimeout(() => { if (feedbackEl) feedbackEl.textContent = ''; }, 2000);
                 console.error('Copy to clipboard error: ', err);
            }
            window.getSelection().removeAllRanges(); 
        }
        
        function setInitialDefaults() {
            handleProviderChange(); 
            document.querySelector('input[name="installationTime"][value="weekday"]').checked = true;
            if(skyNoGiftDiscountEl) skyNoGiftDiscountEl.checked = false;
             updateSkyNoGiftDiscountCheckboxState(); // MODIFIED: Call on initial load
        }
        
        // --- Event Listeners ---
        providerRadios.forEach(radio => radio.addEventListener('change', handleProviderChange));
        skyInternetTypeRadios.forEach(radio => radio.addEventListener('change', populateInternetPlans)); // This calls updateSkyNoGiftDiscountCheckboxState via populateInternetPlans
        internetPlanEl.addEventListener('change', () => {
            populateTvPlans(); 
            handleWifiLogic(); 
            updateSkyNoGiftDiscountCheckboxState(); // MODIFIED: Call here
        });
        calculateButton.addEventListener('click', calculateAndDisplayResults);

        // --- Initial Page Load ---
        window.onload = setInitialDefaults;

    </script>
</body>
</html>
